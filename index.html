
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fill Out na, KasaMath!</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
            font-size: 24px;
            text-align: center;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 600;
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        input[type="text"],
        input[type="email"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        input[type="email"]:focus,
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .readonly-field {
            background: #f8f9fa;
            color: #666;
        }

        .submit-btn {
            background: #28a745;
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            transition: background 0.3s, transform 0.1s;
        }

        .submit-btn:hover {
            background: #218838;
        }

        .submit-btn:active {
            transform: scale(0.98);
        }

        .submit-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .message-box {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .message-box.success {
            background: #d4edda;
            border-left: 4px solid #28a745;
            color: #155724;
            display: block;
        }

        .message-box.error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            color: #721c24;
            display: block;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            font-size: 13px;
            color: #555;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 0.8s linear infinite;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìù Order Form</h1>
        
        <div id="messageBox" class="message-box"></div>
        
        <form id="orderForm">
            <div class="form-group">
                <label for="blogTitle">Product Name</label>
                <input type="text" id="blogTitle" name="blogTitle" class="readonly-field" readonly>
            </div>
            
            <div class="form-group">
                <label for="customerName">Your Name *</label>
                <input type="text" id="customerName" name="customerName" required placeholder="Enter your name">
            </div>
            
            <div class="form-group">
                <label for="customerEmail">Your Email *</label>
                <input type="email" id="customerEmail" name="customerEmail" required placeholder="Enter your email">
            </div>
            
            <div class="form-group">
                <label for="orderDetails">Order Details</label>
                <textarea id="orderDetails" name="orderDetails" placeholder="Add any special requests or notes..."></textarea>
            </div>
            
            <button type="submit" class="submit-btn" id="submitBtn">
                Submit Order
            </button>
        </form>
        
        <div class="info-box">
            <strong>üìå Note:</strong> The product name is automatically detected. Fill in your details and click Submit Order to send your request.
        </div>
    </div>

    <script>
        const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1438369273872515124/3k2OCJeg3mH0ut93rtxrMpgVxNi7PEjBpu0I-CkRRHUPRGbOveWmuiFahHuNZWzHZEKB';
        
        // Extract product ID from URL
        function extractProductId() {
            let productId = 'Unknown Product';
            
            // Try to get from URL parameter first
            const urlParams = new URLSearchParams(window.location.search);
            const idFromParam = urlParams.get('id');
            if (idFromParam) {
                return idFromParam.toUpperCase();
            }
            
            // Try to get from referrer URL
            let urlToCheck = document.referrer;
            
            // If no referrer, try parent window (if in iframe)
            if (!urlToCheck) {
                try {
                    if (window.parent && window.parent !== window) {
                        urlToCheck = window.parent.location.href;
                    }
                } catch (e) {
                    // Cross-origin restriction
                }
            }
            
            // If still no URL, use current URL
            if (!urlToCheck) {
                urlToCheck = window.location.href;
            }
            
            // Extract product ID from URL path
            // Example: https://texmathpro.github.io/posts/g8-q4-ak/ -> G8-Q4-AK
            if (urlToCheck) {
                try {
                    const url = new URL(urlToCheck);
                    const pathParts = url.pathname.split('/').filter(part => part.length > 0);
                    
                    // Get the last part of the path (should be the product ID)
                    if (pathParts.length > 0) {
                        const lastPart = pathParts[pathParts.length - 1];
                        // Convert to uppercase and keep the format
                        productId = lastPart.toUpperCase();
                    }
                } catch (e) {
                    console.error('Error parsing URL:', e);
                }
            }
            
            return productId;
        }
        
        // Handle form submission
        document.getElementById('orderForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const messageBox = document.getElementById('messageBox');
            
            // Get form values
            const blogTitle = document.getElementById('blogTitle').value;
            const customerName = document.getElementById('customerName').value;
            const customerEmail = document.getElementById('customerEmail').value;
            const orderDetails = document.getElementById('orderDetails').value;
            
            // Disable button and show loading
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<span class="loading"></span>Submitting...';
            messageBox.style.display = 'none';
            
            try {
                // Create Discord embed message
                const discordMessage = {
                    content: 'üìã **New Order Received**',
                    embeds: [{
                        title: 'üõí Order Details',
                        color: 5814783, // Purple color
                        fields: [
                            {
                                name: 'üõçÔ∏è Product Name',
                                value: blogTitle,
                                inline: false
                            },
                            {
                                name: 'üë§ Customer Name',
                                value: customerName,
                                inline: true
                            },
                            {
                                name: 'üìß Email',
                                value: customerEmail,
                                inline: true
                            }
                        ],
                        timestamp: new Date().toISOString(),
                        footer: {
                            text: 'Order Form Submission'
                        }
                    }]
                };
                
                // Add order details if provided
                if (orderDetails.trim()) {
                    discordMessage.embeds[0].fields.push({
                        name: 'üìå Additional Details',
                        value: orderDetails,
                        inline: false
                    });
                }
                
                // Send to Discord
                const response = await fetch(DISCORD_WEBHOOK, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(discordMessage)
                });
                
                if (response.ok || response.status === 204) {
                    // Success
                    messageBox.className = 'message-box success';
                    messageBox.innerHTML = '<strong>‚úì Success!</strong> Your order has been submitted successfully. We\'ll contact you soon!';
                    messageBox.style.display = 'block';
                    
                    // Reset form
                    document.getElementById('customerName').value = '';
                    document.getElementById('customerEmail').value = '';
                    document.getElementById('orderDetails').value = '';
                    
                    // Scroll to message
                    messageBox.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                } else {
                    throw new Error('Failed to submit order');
                }
            } catch (error) {
                // Error
                messageBox.className = 'message-box error';
                messageBox.innerHTML = '<strong>‚úó Error!</strong> Failed to submit order. Please try again or contact us directly.';
                messageBox.style.display = 'block';
                console.error('Submission error:', error);
            } finally {
                // Re-enable button
                submitBtn.disabled = false;
                submitBtn.innerHTML = 'Submit Order';
            }
        });
        
        // Initialize on page load
        window.addEventListener('load', function() {
            const productId = extractProductId();
            document.getElementById('blogTitle').value = productId;
        });
    </script>
</body>
</html>
